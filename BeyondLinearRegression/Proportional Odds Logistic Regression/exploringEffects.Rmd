---
title: "Exploring the effects package"
author: "Jackson Hughes"
date: "10/18/2021"
output: 
  html_document:
    keep_md: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(MASS)
library(effects)
library(nnet)
library(Hmisc)
library(tidyverse)
```

### Import data

```{r}
setwd("G:/Shared drives/CEG Two-Stage Exams Analysis/Jackson/beyond-linear-regression/BeyondLinearRegression/Proportional Odds Logistic Regression")
polrData <- read_csv("polrData.csv")
```

### I will be exploring the `effects` package using the POLR data from the "beyond linear regression" repository

### Assign `Dominator` as factor; relevel `Ethnicity` so that the reference is white students

```{r}
polrData$Dominator <- factor(polrData$Dominator)
polrData$Ethnicity <- relevel(as.factor(polrData$Ethnicity), ref="White")
```

### Following Theobald's model selection, we ended up with the following model:

```{r}
m <- polr(Dominator ~  CourseGrade + Ethnicity +
             ActivityType, 
             data=polrData, Hess=T)
summary(m)
```

### Convert log odds to odds by exponentiating

```{r}
exp(cbind(OR = coef(m), confint(m)))
```

### The `OR` column represents the odds of answering one higher level in the Likert-scale that there was a "dominator" in the group as opposed to the relevant reference groups.

### Now let's finally explore the `effects` package.
### The effect of treatment on reporting a dominator:

```{r}
domEff <- Effect("ActivityType",m)
summary(domEff)
```

#### The odds ratios have been converted to probabilities, which is extremely helpful in interpreting the output! For instance, we can see that the probability of students in the constructive activity type answering "strongly disagree" is less than that of students in the interactive activity type.

### We can convert the effects list to a data frame:

```{r}
x <- as.data.frame(domEff)
x
```

### Now let's try plotting the data...

```{r}
domEff <- Effect("ActivityType",m)
plot(domEff, style="stacked", ylab="Probability of Response", xlab= "Treatment", 
     main="Effect of Treatment on Reporting a Dominator")
```

#### I tried to recreate this plot using `ggplot` and the effects data frame instead of `plot` and the effects list, but I couldn't figure it out.

